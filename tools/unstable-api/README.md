# Unstable API Dump

This tool will dump the public API for an unstable feature.

## Usage

From this directory, run something like:

```shell
cargo run --release -- --feature $feature --repo-root $path_to_rust | rustfmt
```

where `$feature` is the name of the unstable feature and `$path_to_rust` is the path to a local clone of `rust-lang/rust`. You'll probably need to run `x.py` first to make sure submodules are cloned.

You can also install it as a Cargo tool and use it that way:

```shell
cargo install --path .
cargo unstable-api --feature $feature --repo-root $path_to_rust | rustfmt
```

## Limitations

APIs that are generated by macros won't be picked up. This tool just parses the source code so it can be run without needing to build the standard library itself.

## Example output

It'll output something like:

```rust
pub mod core {
    pub mod lazy {
        pub struct OnceCell<T> {}
        impl<T> Default for OnceCell<T> {
            fn default() -> Self {}
        }
        impl<T: fmt::Debug> fmt::Debug for OnceCell<T> {
            fn fmt(&self, f: &mut fmt::Formatter<'_>) -> fmt::Result {}
        }
        impl<T: Clone> Clone for OnceCell<T> {
            fn clone(&self) -> OnceCell<T> {}
        }
        impl<T: PartialEq> PartialEq for OnceCell<T> {
            fn eq(&self, other: &Self) -> bool {}
        }
        impl<T: Eq> Eq for OnceCell<T> {}
        impl<T> From<T> for OnceCell<T> {
            fn from(value: T) -> Self {}
        }
        impl<T> OnceCell<T> {
            pub const fn new() -> OnceCell<T> {}
            pub fn get(&self) -> Option<&T> {}
            pub fn get_mut(&mut self) -> Option<&mut T> {}
            pub fn set(&self, value: T) -> Result<(), T> {}
            pub fn get_or_init<F>(&self, f: F) -> &T
            where
                F: FnOnce() -> T,
            {
            }
            pub fn get_or_try_init<F, E>(&self, f: F) -> Result<&T, E>
            where
                F: FnOnce() -> Result<T, E>,
            {
            }
            pub fn into_inner(self) -> Option<T> {}
            pub fn take(&mut self) -> Option<T> {}
        }
        pub struct Lazy<T, F = fn() -> T> {}
        impl<T: fmt::Debug, F> fmt::Debug for Lazy<T, F> {
            fn fmt(&self, f: &mut fmt::Formatter<'_>) -> fmt::Result {}
        }
        impl<T, F> Lazy<T, F> {
            pub const fn new(init: F) -> Lazy<T, F> {}
        }
        impl<T, F: FnOnce() -> T> Lazy<T, F> {
            pub fn force(this: &Lazy<T, F>) -> &T {}
        }
        impl<T, F: FnOnce() -> T> Deref for Lazy<T, F> {
            type Target = T;
            fn deref(&self) -> &T {}
        }
        impl<T: Default> Default for Lazy<T> {
            fn default() -> Lazy<T> {}
        }
    }
}
pub mod std {
    pub mod lazy {
        pub use core::lazy::*;
        pub struct SyncOnceCell<T> {}
        unsafe impl<T: Sync + Send> Sync for SyncOnceCell<T> {}
        unsafe impl<T: Send> Send for SyncOnceCell<T> {}
        impl<T: RefUnwindSafe + UnwindSafe> RefUnwindSafe for SyncOnceCell<T> {}
        impl<T: UnwindSafe> UnwindSafe for SyncOnceCell<T> {}
        impl<T> Default for SyncOnceCell<T> {
            fn default() -> SyncOnceCell<T> {}
        }
        impl<T: fmt::Debug> fmt::Debug for SyncOnceCell<T> {
            fn fmt(&self, f: &mut fmt::Formatter<'_>) -> fmt::Result {}
        }
        impl<T: Clone> Clone for SyncOnceCell<T> {
            fn clone(&self) -> SyncOnceCell<T> {}
        }
        impl<T> From<T> for SyncOnceCell<T> {
            fn from(value: T) -> Self {}
        }
        impl<T: PartialEq> PartialEq for SyncOnceCell<T> {
            fn eq(&self, other: &SyncOnceCell<T>) -> bool {}
        }
        impl<T: Eq> Eq for SyncOnceCell<T> {}
        impl<T> SyncOnceCell<T> {
            pub const fn new() -> SyncOnceCell<T> {}
            pub fn get(&self) -> Option<&T> {}
            pub fn get_mut(&mut self) -> Option<&mut T> {}
            pub fn set(&self, value: T) -> Result<(), T> {}
            pub fn get_or_init<F>(&self, f: F) -> &T
            where
                F: FnOnce() -> T,
            {
            }
            pub fn get_or_try_init<F, E>(&self, f: F) -> Result<&T, E>
            where
                F: FnOnce() -> Result<T, E>,
            {
            }
            pub(crate) fn get_or_init_pin<F, G>(self: Pin<&Self>, f: F, g: G) -> Pin<&T>
            where
                F: FnOnce() -> T,
                G: FnOnce(Pin<&mut T>),
            {
            }
            pub fn into_inner(mut self) -> Option<T> {}
            pub fn take(&mut self) -> Option<T> {}
            fn is_initialized(&self) -> bool {}
            fn initialize<F, E>(&self, f: F) -> Result<(), E>
            where
                F: FnOnce() -> Result<T, E>,
            {
            }
            unsafe fn get_unchecked(&self) -> &T {}
            unsafe fn get_unchecked_mut(&mut self) -> &mut T {}
        }
        unsafe impl<#[may_dangle] T> Drop for SyncOnceCell<T> {
            fn drop(&mut self) {}
        }
        pub struct SyncLazy<T, F = fn() -> T> {}
        impl<T: fmt::Debug, F> fmt::Debug for SyncLazy<T, F> {
            fn fmt(&self, f: &mut fmt::Formatter<'_>) -> fmt::Result {}
        }
        unsafe impl<T, F: Send> Sync for SyncLazy<T, F> where SyncOnceCell<T>: Sync {}
        impl<T, F: UnwindSafe> RefUnwindSafe for SyncLazy<T, F> where SyncOnceCell<T>: RefUnwindSafe {}
        impl<T, F: UnwindSafe> UnwindSafe for SyncLazy<T, F> where SyncOnceCell<T>: UnwindSafe {}
        impl<T, F> SyncLazy<T, F> {
            pub const fn new(f: F) -> SyncLazy<T, F> {}
        }
        impl<T, F: FnOnce() -> T> SyncLazy<T, F> {
            pub fn force(this: &SyncLazy<T, F>) -> &T {}
        }
        impl<T, F: FnOnce() -> T> Deref for SyncLazy<T, F> {
            type Target = T;
            fn deref(&self) -> &T {}
        }
        impl<T: Default> Default for SyncLazy<T> {
            fn default() -> SyncLazy<T> {}
        }
    }
}
```
